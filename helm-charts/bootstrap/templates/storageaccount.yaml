{{- $root := . }}
{{- $blobService := default (dict "containers" (list)) $root.Values.storageAccount.blobService }}

apiVersion: storage.azure.com/v1api20230101
kind: StorageAccount
metadata:
  name: {{ template "ipaffs-common.azure.storageAccount" $root }}
  labels:
      {{- include "ipaffs-common.labels" $root | nindent 4 }}
spec:
  owner:
    name: {{ template "ipaffs-common.azure.resourceGroup" $root }}
  location: {{ $root.Values.azure.location }}
  kind: StorageV2
  sku:
    name: Standard_GRS

---
apiVersion: storage.azure.com/v1api20230101
kind: StorageAccountsBlobService
metadata:
  name: default
  labels:
    {{- include "ipaffs-common.labels" $root | nindent 4 }}
spec:
  owner:
    name: {{ template "ipaffs-common.azure.storageAccount" $root }}


{{- range $blobService.containers }}
---
apiVersion: storage.azure.com/v1api20230101
kind: StorageAccountsBlobServicesContainer
metadata:
  name: {{ . }}
  labels:
    {{- include "ipaffs-common.labels" $root | nindent 4 }}
  annotations:
    serviceoperator.azure.com/reconcile-policy: manage
spec:
  owner:
    name: default
  publicAccess: None

{{- end }}
