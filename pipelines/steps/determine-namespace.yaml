parameters:
  - name: branch
    type: string

steps:
  - task: Bash@3
    name: Namespace
    displayName: Determine namespace
    env:
      BRANCH: ${{ parameters.branch }}
    inputs:
      targetType: inline
      scriptType: bash
      script: |
        set -eux -o pipefail
        NAMESPACE="$(echo "${BRANCH}" | sed -E 's/[^0-9A-Za-z]/-/g' | sed -E 's/^-+//g' | sed -E 's/-+$//g' | tr '[:upper:]' '[:lower:]' | cut -c1-253)"
        echo "##vso[task.setvariable variable=namespace;isOutput=true]${NAMESPACE}"

# vim: set ts=2 sts=2 sw=2 et:
