parameters:
  name: serviceName
  type: string

jobs:
  - job: Package
    displayName: Package
    steps:
      - download: current
        artifact: WebAppJar
        displayName: Download WebAppJar artifact
        
      - task: CopyFiles@2
        displayName: Copy WebAppJar to target folder
        inputs:
          SourceFolder: $(Pipeline.Workspace)/WebAppJar/
          TargetFolder: 'service/target'
          
      - task: AzureCLI@2
        displayName: Build and Push Container Image
        inputs:
          azureSubscription: $(serviceConnection)
          scriptType: bash
          scriptLocation: inlineScript
          inlineScript: |
            az acr login --name $(acrName)
            docker build --platform=linux/amd64 --build-arg SERVICE_VERSION=poc --tag ${{ parameters.serviceName }}:$(Build.BuildNumber) --file ./service/Dockerfile.k8s ./service
            docker tag ${{ parameters.serviceName }}:$(Build.BuildNumber) $(acrLoginServer)/ipaffs/${{ parameters.serviceName }}:$(Build.BuildNumber)
            docker push $(acrLoginServer)/ipaffs/${{ parameters.serviceName }}:$(Build.BuildNumber)

# vim: set ts=2 sts=2 sw=2 et:
